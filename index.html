import React, { useState, useEffect } from 'react';

export default function App() {
  const [name, setName] = useState('');
  const [progress, setProgress] = useState(100);
  const [hasFinished, setHasFinished] = useState(false);

  // ì§„í–‰ë„(progress)ê°€ 0ì´ ë˜ë©´ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
  useEffect(() => {
    if (progress === 0 && !hasFinished) {
      setHasFinished(true);
    }
  }, [progress, hasFinished]);

  // ì§„í–‰ë„ë¥¼ 0~1 ì‚¬ì´ì˜ ê°’ìœ¼ë¡œ ë³€í™˜ (1: ì¢Œì ˆ, 0: í–‰ë³µ)
  const t = progress / 100;

  // ì ¤ë¦¬ ì• ë‹ˆë©”ì´ì…˜ ê³„ì‚°
  let jellyX = 90;
  let jellyY = 65;
  let jellyScale = 0;
  let jellyRot = 45;

  if (t > 0.8) {
    // ì ¤ë¦¬ê°€ ë“±ì¥í•˜ëŠ” êµ¬ê°„
    jellyScale = (1 - t) * 5; 
  } else if (t > 0.4) {
    // ì ¤ë¦¬ê°€ ì…ìœ¼ë¡œ ë‹¤ê°€ê°€ëŠ” êµ¬ê°„
    jellyScale = 1;
    let p = (0.8 - t) / 0.4; // 0 ~ 1
    jellyX = 90 - p * 40;    // 90 -> 50
    jellyRot = 45 - p * 45;  // 45 -> 0
  } else if (t > 0.2) {
    // ì… ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ë©° ì‚¬ë¼ì§€ëŠ” êµ¬ê°„
    jellyX = 50;
    jellyRot = 0;
    let p = (0.4 - t) / 0.2; // 0 ~ 1
    jellyScale = 1 - p;      // 1 -> 0
  } else {
    // ë‹¤ ë¨¹ì€ ìƒíƒœ
    jellyScale = 0;
  }

  return (
    <div className="min-h-screen bg-[#FFF6F0] flex flex-col items-center py-10 px-6 font-sans text-[#4A3320] overflow-hidden">
      
      {/* ë¡œê³  & ìƒë‹¨ */}
      <div className="w-full max-w-md text-center mb-10">
        <h2 className="text-[#FF6B00] font-black text-3xl italic tracking-tighter mb-8">safrise</h2>
        
        <div className="bg-white p-6 rounded-3xl shadow-sm border border-[#FFE5CC]">
          <h1 className="text-xl font-bold mb-4 text-[#FF6B00]">ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</h1>
          <input
            type="text"
            placeholder="ex) ê¹€ì‚¬í”„"
            value={name}
            onChange={(e) => setName(e.target.value)}
            className="w-full px-5 py-3 border-2 border-[#FFD1A9] rounded-2xl focus:outline-none focus:border-[#FF6B00] focus:ring-4 focus:ring-[#FF6B00]/20 text-center text-lg font-medium transition-all"
            disabled={hasFinished}
          />
        </div>
      </div>

      {/* ë©”ì¸ ì¸í„°ë™ì…˜ ì˜ì—­ */}
      <div className="w-full max-w-md flex flex-col items-center">
        
        {!hasFinished ? (
          <div className="h-16 flex items-center justify-center mb-4">
            <p className="text-lg font-bold text-[#FF6B00] animate-pulse bg-[#FFE5CC] px-5 py-2 rounded-full">
              ğŸ‘† ì†ê°€ë½ì„ ì™¼ìª½ìœ¼ë¡œ ì›€ì§ì—¬ì„œ<br/><span className="block text-center mt-1">ë¯¸ì†Œë¥¼ ë˜ì°¾ê²Œ í•´ì£¼ì„¸ìš”!</span>
            </p>
          </div>
        ) : (
          <div className="h-16 flex items-center justify-center mb-4">
            <p className="text-xl font-bold text-[#FF6B00]">
              ì™„ë²½í•´ìš”! ğŸ‰
            </p>
          </div>
        )}

        {/* ì• ë‹ˆë©”ì´ì…˜ ì´ë¯¸ì§€ ì˜ì—­ */}
        <div className="relative w-64 h-64 mb-8 bg-white rounded-full shadow-lg border-8 border-[#FFE5CC] flex items-center justify-center overflow-hidden transition-all duration-700">
          <InteractiveFace progress={progress} jellyX={jellyX} jellyScale={jellyScale} jellyRot={jellyRot} />
        </div>

        {/* ìŠ¬ë¼ì´ë” ì œì–´ ì»¨íŠ¸ë¡¤ */}
        {!hasFinished && (
          <div className="w-full relative mb-16 flex flex-col items-center">
            <input
              type="range"
              min="0"
              max="100"
              value={progress}
              onChange={(e) => setProgress(Number(e.target.value))}
              className="w-full h-8 bg-[#FFD1A9] rounded-full appearance-none cursor-pointer outline-none slider-thumb-orange shadow-inner"
              style={{
                direction: 'ltr',
                WebkitAppearance: 'none',
              }}
            />
            {/* ì»¤ìŠ¤í…€ ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */}
            <style>{`
              input[type=range]::-webkit-slider-thumb {
                -webkit-appearance: none;
                height: 40px;
                width: 40px;
                border-radius: 50%;
                background: #FF6B00;
                cursor: pointer;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                border: 4px solid #FFF;
                transform: scale(1.1);
                transition: transform 0.1s;
              }
              input[type=range]::-webkit-slider-thumb:active {
                transform: scale(1.3);
              }
            `}</style>
            <div className="flex justify-between w-full mt-3 px-2 text-sm font-semibold text-[#FF8C33]">
              <span>í–‰ë³µ ğŸ¥°</span>
              <span className="animate-pulse">ğŸ‘ˆ ìŠ¬ë¼ì´ë“œ!</span>
              <span>ìš°ìš¸ ğŸ˜­</span>
            </div>
          </div>
        )}

        {/* ì™„ë£Œ ìƒíƒœ í…ìŠ¤íŠ¸ (í•˜ë‹¨ ê³ ì •) */}
        {hasFinished && (
          <div className="text-center w-full animate-fade-in-up transition-opacity duration-1000 mb-10 bg-white p-6 rounded-3xl shadow-md border border-[#FFE5CC]">
            <p className="text-xl font-bold mb-3 text-[#4A3320]">
              í™œì§ ì›ƒëŠ” ëª¨ìŠµì´ ì˜ˆìœ <span className="text-[#FF6B00] underline decoration-4 decoration-[#FFD1A9] underline-offset-4">{name || 'ê³ ê°'}</span>ë‹˜,
            </p>
            <p className="text-lg text-[#FF8C33] font-bold">
              ì„¸ë¡œí† ë‹Œ ê°€ë“í•œ í•˜ë£¨ë¥¼ ë³´ë‚´ì„¸ìš” ğŸ«¶ğŸ»ğŸ‰
            </p>
          </div>
        )}

      </div>

      {/* í‘¸í„° ì˜ì—­ (ì œí’ˆ êµ¬ë§¤ ë§í¬) */}
      <div className="mt-auto text-center pt-10 pb-6 border-t-2 border-[#FFE5CC]/50 w-full max-w-md">
        <p className="text-[#8C664D] mb-4 font-bold tracking-wide italic text-lg">
          Wanna smile together?
          <br />
          Try safrise!
        </p>
        <a 
          href="#" 
          className="inline-flex items-center justify-center bg-[#FF6B00] text-white px-10 py-4 rounded-full font-bold shadow-[0_8px_20px_-5px_rgba(255,107,0,0.5)] hover:bg-[#E65C00] hover:-translate-y-1 transition-all duration-300 w-full text-lg"
          onClick={(e) => { e.preventDefault(); alert("êµ¬ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤! ğŸ›’"); }}
        >
          ì œí’ˆ êµ¬ë§¤í•˜ê¸° ğŸŠ
        </a>
      </div>

    </div>
  );
}

// ë¶€ë“œëŸ¬ìš´ êµì°¨ í˜ì´ë”© ê¸°ë²•ì„ ì‚¬ìš©í•œ SVG ì–¼êµ´ ì»´í¬ë„ŒíŠ¸
function InteractiveFace({ progress, jellyX, jellyScale, jellyRot }) {
  const t = progress / 100;
  
  // ìƒíƒœë³„ ì˜¤í¼ì‹œí‹° ê³„ì‚°
  const frustratedOpacity = Math.max(0, (t - 0.5) * 2);
  const neutralOpacity = 1 - Math.abs(t - 0.5) * 2;
  const happyOpacity = Math.max(0, (0.5 - t) * 2);

  return (
    <svg viewBox="0 0 100 100" className="w-full h-full relative" style={{ isolation: 'isolate' }}>
      
      {/* ê¸°ë³¸ ì–¼êµ´ ë² ì´ìŠ¤ - tê°’ì— ë”°ë¼ ìƒ‰ìƒì´ ë³€í•¨ */}
      <circle cx="50" cy="50" r="40" 
        fill={t > 0.6 ? '#FFD4B2' : (t > 0.2 ? '#FFC799' : '#FFB266')} 
        style={{ transition: 'fill 0.5s ease-out' }} 
      />

      {/* 1. ìš°ìš¸í•œ ì–¼êµ´ (Frustrated) */}
      <g opacity={frustratedOpacity} style={{ transition: 'opacity 0.1s' }}>
        {/* ëˆˆì¹ */}
        <path d="M 30 40 L 40 45 M 70 40 L 60 45" stroke="#734A30" strokeWidth="3" strokeLinecap="round" />
        {/* ëˆˆ */}
        <path d="M 30 50 Q 35 45 40 50 M 70 50 Q 65 45 60 50" stroke="#734A30" strokeWidth="3" fill="none" />
        {/* ìš°ìš¸í•œ ì… */}
        <path d="M 40 70 Q 50 60 60 70" stroke="#734A30" strokeWidth="3" fill="none" />
        {/* ë•€/ëˆˆë¬¼ë°©ìš¸ */}
        <path d="M 75 30 Q 80 40 75 45 Q 70 40 75 30" fill="#66B2FF" />
        <path d="M 35 30 L 35 35 M 40 25 L 40 32 M 45 30 L 45 35" stroke="#B3D9FF" strokeWidth="2" strokeLinecap="round" />
      </g>

      {/* 2. ê¸°ëŒ€í•˜ëŠ”/ì… ë²Œë¦¬ëŠ” ì–¼êµ´ (Neutral / Eating) */}
      <g opacity={neutralOpacity} style={{ transition: 'opacity 0.1s' }}>
        {/* ëˆˆì¹ */}
        <path d="M 30 40 L 40 40 M 70 40 L 60 40" stroke="#734A30" strokeWidth="2" strokeLinecap="round" opacity="0.5" />
        {/* ëˆˆì¹ ëŒ€ì‹  ë†€ë€ ëˆˆ */}
        <circle cx="35" cy="45" r="3" fill="#734A30" />
        <circle cx="65" cy="45" r="3" fill="#734A30" />
        {/* ì˜¤ë¬¼ì˜¤ë¬¼ ë²Œë¦° ì… */}
        <ellipse cx="50" cy="65" rx="6" ry="8" fill="#734A30" />
      </g>

      {/* 3. í–‰ë³µí•œ ì–¼êµ´ (Happy) */}
      <g opacity={happyOpacity} style={{ transition: 'opacity 0.1s' }}>
        {/* ë³¼í„°ì¹˜ (Blush) */}
        <circle cx="25" cy="55" r="7" fill="#FF704D" opacity="0.5"/>
        <circle cx="75" cy="55" r="7" fill="#FF704D" opacity="0.5"/>
        {/* ì›ƒëŠ” ëˆˆ (^^) */}
        <path d="M 30 45 Q 35 38 40 45 M 70 45 Q 65 38 60 45" stroke="#734A30" strokeWidth="3" fill="none" strokeLinecap="round" />
        {/* í™œì§ ì›ƒëŠ” ì… */}
        <path d="M 35 60 Q 50 85 65 60 Z" fill="#FF5252" />
        {/* ì¹˜ì•„ ë””í…Œì¼ */}
        <path d="M 43 60 Q 50 66 57 60 Z" fill="#FFFFFF" />
      </g>

      {/* 4. ì• ë‹ˆë©”ì´ì…˜ ì ¤ë¦¬ (Jelly) */}
      <g transform={`translate(${jellyX}, 65) scale(${jellyScale}) rotate(${jellyRot})`}>
        {/* ì ¤ë¦¬ ë³¸ì²´ */}
        <rect x="-8" y="-6" width="16" height="12" rx="6" fill="#FF6B00" stroke="#D95C00" strokeWidth="1" />
        {/* ì ¤ë¦¬ í•˜ì´ë¼ì´íŠ¸ */}
        <path d="M -4 -3 Q 0 -5 4 -3" stroke="#FFA366" strokeWidth="2" fill="none" strokeLinecap="round" />
      </g>

      {/* 5. í–‰ë³µí•  ë•Œ í„°ì§€ëŠ” ë°˜ì§ì´ íš¨ê³¼ (ë³„ëª¨ì–‘) */}
      <g opacity={progress === 0 ? 1 : 0} style={{ transition: 'opacity 0.5s ease-in-out' }}>
        <path d="M 20 20 L 22 26 L 28 28 L 22 30 L 20 36 L 18 30 L 12 28 L 18 26 Z" fill="#FFD1A9" className="animate-spin" style={{ transformOrigin: '20px 28px' }}/>
        <path d="M 80 20 L 82 26 L 88 28 L 82 30 L 80 36 L 78 30 L 72 28 L 78 26 Z" fill="#FFD1A9" className="animate-spin" style={{ transformOrigin: '80px 28px' }}/>
      </g>
    </svg>
  );
}
